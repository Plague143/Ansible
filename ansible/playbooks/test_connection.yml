---
- name: Test Semaphore Connection
  hosts: all
  become: yes
  gather_facts: yes

  tasks:
    - name: Display connection success
      debug:
        msg: "âœ… Successfully connected to {{ inventory_hostname }} via Semaphore!"
    
    - name: Gather system facts
      setup:
    
    - name: Display system info
      debug:
        msg: |
          Server: {{ inventory_hostname }}
          OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
          IP: {{ ansible_default_ipv4.address }}
          Memory: {{ ansible_memtotal_mb }} MB
    
    - name: Create test directory
      file:
        path: /opt/semaphore_test
        state: directory
        mode: '0755'
    
    - name: Write test file
      copy:
        content: |
          # Test file from Semaphore
          Created: {{ ansible_date_time.iso8601 }}
          Host: {{ inventory_hostname }}
          User: {{ ansible_user_id }}
        dest: /opt/semaphore_test/readme.txt
        mode: '0644'
    
    - name: Show created file
      command: ls -la /opt/semaphore_test/
      register: ls_result
    
    - name: Display file list
      debug:
        var: ls_result.stdout_lines
